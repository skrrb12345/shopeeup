<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CareMarket â€“ í€µ ë¦¬í”Œë¼ì´ & ê°€ê²©ê³„ì‚°ê¸° (ì™„ì„±í˜•)</title>
  <meta name="theme-color" content="#0ea5e9" />
  <style>
    :root{--bg:#0b1220;--panel:#0f172a;--muted:#94a3b8;--text:#e5e7eb;--brand:#0ea5e9;--ok:#10b981;--warn:#f59e0b;--danger:#ef4444}
    *{box-sizing:border-box} body{margin:0;font-family:Pretendard,system-ui,-apple-system,Segoe UI,Roboto,Noto Sans KR,sans-serif;background:#0b1220;color:var(--text)}
    .wrap{max-width:960px;margin:auto;padding:20px}
    h1{font-size:20px;font-weight:700;margin:0 0 10px}
    .tabs{display:flex;gap:6px;margin:16px 0 10px}
    .tab{padding:10px 14px;border-radius:12px;border:1px solid #334155;background:#0f172a;color:#cbd5e1;cursor:pointer}
    .tab.active{background:#0ea5e922;border-color:#0ea5e9}
    .panel{background:#0f172a;border:1px solid #334155;border-radius:12px;padding:16px;margin-bottom:16px}
    input,select,textarea{width:100%;background:#0b1220;border:1px solid #334155;border-radius:10px;color:#e5e7eb;padding:10px;margin-top:4px}
    .row{display:flex;gap:8px;flex-wrap:wrap;align-items:center;margin-top:10px}
    .btn{padding:10px 14px;border-radius:10px;background:#0ea5e9;color:white;border:none;cursor:pointer}
    .btn.ghost{background:transparent;border:1px solid #334155;color:#94a3b8}
    .stat{background:#0b1220;border:1px solid #334155;border-radius:10px;padding:10px;margin-top:10px}
    .toast{position:fixed;left:50%;bottom:24px;transform:translateX(-50%);background:#111827;border:1px solid #374151;color:#e5e7eb;padding:10px 14px;border-radius:10px;opacity:0;transition:.3s}
    .toast.show{opacity:1}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>CareMarket â€“ í€µ ë¦¬í”Œë¼ì´ & ê°€ê²©ê³„ì‚°ê¸°</h1>
    <div class="tabs">
      <button class="tab active" data-tab="calc">ê³„ì‚°ê¸°</button>
      <button class="tab" data-tab="tpl">í…œí”Œë¦¿</button>
      <button class="tab" data-tab="settings">ì„¤ì •</button>
    </div>

    <section class="panel" data-panel="calc">
      <label>êµ­ê°€ ì„ íƒ</label>
      <select id="marketSelect">
        <option value="VN">ë² íŠ¸ë‚¨ (VND)</option>
        <option value="TH">íƒœêµ­ (THB)</option>
        <option value="SG">ì‹±ê°€í¬ë¥´ (SGD)</option>
      </select>
      <label>íŒë§¤ê°€ (í˜„ì§€ í†µí™”)</label>
      <input id="price" placeholder="ì˜ˆ: 199000" type="number" />
      <label>ì›ê°€ (KRW)</label>
      <input id="cost" placeholder="ì˜ˆ: 12000" type="number" />

      <div class="row">
        <button class="btn" id="calcBtn">ê³„ì‚°</button>
      </div>
      <div id="result" class="stat"></div>
    </section>

    <section class="panel" data-panel="tpl" hidden>
      <label>ì–¸ì–´ ì„ íƒ</label>
      <select id="langSelect">
        <option value="ko">í•œêµ­ì–´</option>
        <option value="vi">ë² íŠ¸ë‚¨ì–´</option>
        <option value="th">íƒœêµ­ì–´</option>
        <option value="en">ì˜ì–´</option>
      </select>
      <label>ìƒí™© ì„ íƒ</label>
      <select id="tagSelect"></select>
      <textarea id="tplText"></textarea>
      <div class="row">
        <button class="btn" id="copyBtn">ë³µì‚¬í•˜ê¸°</button>
      </div>
    </section>

    <section class="panel" data-panel="settings" hidden>
      <h3>ê¸°ë³¸ ì„¤ì •</h3>
      <ul style="font-size:14px;line-height:1.6">
        <li>ğŸ‡»ğŸ‡³ ë² íŠ¸ë‚¨: ì»¤ë¯¸ì…˜ 3% + ê±°ë˜ 4.63% + í”Œë«í¼ ì¸í”„ë¼ 3,000â‚«/ê±´ Â· ë°°ì†¡ë¹„ 20,000â‚« Â· í™˜ìœ¨ 1KRW=18.5â‚«</li>
        <li>ğŸ‡¹ğŸ‡­ íƒœêµ­: ì»¤ë¯¸ì…˜ 7% + ê±°ë˜ 3% + í”Œë«í¼ 1à¸¿/ê±´ Â· ë°°ì†¡ë¹„ 30à¸¿ Â· í™˜ìœ¨ 1KRW=0.027à¸¿</li>
        <li>ğŸ‡¸ğŸ‡¬ ì‹±ê°€í¬ë¥´: ì»¤ë¯¸ì…˜ 7.63% + ê±°ë˜ 2.18% Â· ë°°ì†¡ë¹„ 3SGD Â· í™˜ìœ¨ 1KRW=0.001SGD</li>
        <li style="color:#94a3b8">* ì¹´í…Œê³ ë¦¬/í”„ë¡œê·¸ë¨(Free Shipping, Coins Cashback, Shopee Mall ë“±)ì— ë”°ë¼ ì‹¤ì œ ìˆ˜ìˆ˜ë£Œê°€ ë‹¬ë¼ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì„¤ì • íƒ­ì—ì„œ ê°’ ìˆ˜ì • ê°€ëŠ¥í•©ë‹ˆë‹¤.</li>
      </ul>
    </section>
  </div>
  <div class="toast" id="toast"></div>

  <script>
  // ---------- Data ----------
  const templates = {
    ko: {
      'ë°°ì†¡ì§€ì—° ì•ˆë‚´': 'ì•ˆë…•í•˜ì„¸ìš” {name}ë‹˜, í•œêµ­ì€ í˜„ì¬ ëª…ì ˆ ê¸°ê°„ì´ë¼ ë°°ì†¡ì´ {date}ë¶€í„° ì¬ê°œë©ë‹ˆë‹¤. ê¸°ë‹¤ë ¤ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤.',
      'ì¬ê³ ë¶€ì¡± ì•ˆë‚´': '{name}ë‹˜, ìš”ì²­í•˜ì‹  ìƒí’ˆì€ í˜„ì¬ ì¼ì‹œ í’ˆì ˆ ìƒíƒœì…ë‹ˆë‹¤. {date}ê²½ ì…ê³  ì˜ˆì •ì…ë‹ˆë‹¤.',
    },
    vi: {
      'ThÃ´ng bÃ¡o trá»… giao hÃ ng': 'Xin chÃ o {name}, hiá»‡n HÃ n Quá»‘c Ä‘ang trong ká»³ nghá»‰ lá»…. ÄÆ¡n hÃ ng cá»§a báº¡n sáº½ Ä‘Æ°á»£c gá»­i tá»« ngÃ y {date}. Cáº£m Æ¡n báº¡n Ä‘Ã£ thÃ´ng cáº£m.',
      'Háº¿t hÃ ng táº¡m thá»i': 'Xin lá»—i {name}, sáº£n pháº©m báº¡n muá»‘n táº¡m háº¿t hÃ ng. Dá»± kiáº¿n cÃ³ láº¡i vÃ o {date}.',
    },
    th: {
      'à¹à¸ˆà¹‰à¸‡à¸¥à¹ˆà¸²à¸Šà¹‰à¸²': 'à¸ªà¸§à¸±à¸ªà¸”à¸µ {name} à¸‚à¸“à¸°à¸™à¸µà¹‰à¹€à¸›à¹‡à¸™à¸Šà¹ˆà¸§à¸‡à¸§à¸±à¸™à¸«à¸¢à¸¸à¸”à¸‚à¸­à¸‡à¹€à¸à¸²à¸«à¸¥à¸µ à¸ªà¸´à¸™à¸„à¹‰à¸²à¸ˆà¸°à¹€à¸£à¸´à¹ˆà¸¡à¸ˆà¸±à¸”à¸ªà¹ˆà¸‡à¸•à¸±à¹‰à¸‡à¹à¸•à¹ˆà¸§à¸±à¸™à¸—à¸µà¹ˆ {date} à¸‚à¸­à¸šà¸„à¸¸à¸“à¸„à¹ˆà¸°',
      'à¸ªà¸´à¸™à¸„à¹‰à¸²à¸«à¸¡à¸”à¸Šà¸±à¹ˆà¸§à¸„à¸£à¸²à¸§': 'à¸‚à¸­à¹‚à¸—à¸©à¸„à¹ˆà¸° {name} à¸ªà¸´à¸™à¸„à¹‰à¸²à¸«à¸¡à¸”à¸Šà¸±à¹ˆà¸§à¸„à¸£à¸²à¸§ à¸ˆà¸°à¸à¸¥à¸±à¸šà¸¡à¸²à¹ƒà¸™à¸§à¸±à¸™à¸—à¸µà¹ˆ {date}',
    },
    en: {
      'Shipping delay': 'Hello {name}, due to the Korean holiday, your order will be shipped starting from {date}. Thank you for your patience.',
      'Out of stock': 'Dear {name}, the product is currently out of stock and will be restocked around {date}.',
    }
  };

  const feeData = {
    // VN & TH from Cube Asia take-rate tracker (Feb 3, 2025); SG from SiteGiant (TXN 2.18% GST incl., Dec 30, 2024) + PilotoAsia (commission ranges, Jan 1, 2025)
    VN: { currency: 'VND', commissionPct: 0.03, transPct: 0.0463, infraFixed: 3000, ship: 20000, fx: 18.5 },
    TH: { currency: 'THB', commissionPct: 0.07, transPct: 0.03, infraFixed: 1, ship: 30, fx: 0.027 },
    SG: { currency: 'SGD', commissionPct: 0.0763, transPct: 0.0218, infraFixed: 0, ship: 3, fx: 0.001 },
  };

  // ---------- Helpers ----------
  const $ = q => document.querySelector(q);
  const $$ = q => document.querySelectorAll(q);
  const showToast = msg => {const t=$('#toast');t.textContent=msg;t.classList.add('show');setTimeout(()=>t.classList.remove('show'),1200)};

  // Tabs
  $$('.tab').forEach(tab => tab.addEventListener('click', () => {
    $$('.tab').forEach(t => t.classList.remove('active'));
    tab.classList.add('active');
    const key = tab.dataset.tab;
    $$('section.panel').forEach(sec => sec.hidden = sec.dataset.panel !== key);
  }));

  // Templates UI
  function updateTags() {
    const lang = $('#langSelect').value;
    const tags = Object.keys(templates[lang]);
    const tagSel = $('#tagSelect');
    tagSel.innerHTML = tags.map(t => `<option>${t}</option>`).join('');
    $('#tplText').value = templates[lang][tags[0]];
  }
  $('#langSelect').addEventListener('change', updateTags);
  $('#tagSelect').addEventListener('change', e => {
    const lang = $('#langSelect').value;
    $('#tplText').value = templates[lang][e.target.value];
  });
  updateTags();

  $('#copyBtn').addEventListener('click', async () => {
    const text = $('#tplText').value;
    await navigator.clipboard.writeText(text);
    showToast('ë³µì‚¬ ì™„ë£Œ');
  });

  // Calculator
  $('#calcBtn').addEventListener('click', () => {
    const mk = $('#marketSelect').value;
    const {currency, commissionPct, transPct, infraFixed, ship, fx} = feeData[mk];
    const price = Number($('#price').value || 0);
    const costKRW = Number($('#cost').value || 0);

    const commission = price * (commissionPct || 0);
    const transFee = price * (transPct || 0);
    const platformFixed = infraFixed || 0; // per order fixed fee
    const totalFee = commission + transFee + platformFixed;
    const costLocal = costKRW * fx;
    const profit = price - totalFee - ship - costLocal;
    const margin = price ? (profit / price * 100).toFixed(1) : '0.0';

    $('#result').innerHTML = `
      <div>íŒë§¤ê°€: ${price.toLocaleString()} ${currency}</div>
      <div>ì»¤ë¯¸ì…˜: ${commission.toLocaleString()} ${currency} (${(commissionPct*100).toFixed(2)}%)</div>
      <div>ê±°ë˜ìˆ˜ìˆ˜ë£Œ: ${transFee.toLocaleString()} ${currency} (${(transPct*100).toFixed(2)}%)</div>
      ${platformFixed?`<div>í”Œë«í¼ ê³ ì •: ${platformFixed.toLocaleString()} ${currency}</div>`:''}
      <div>ì´ ìˆ˜ìˆ˜ë£Œ: ${totalFee.toLocaleString()} ${currency}</div>
      <div>ìˆœì´ìµ: ${profit.toLocaleString()} ${currency}</div>
      <div>ë§ˆì§„ìœ¨: ${margin}%</div>
    `;
  });

  // PWA (manifest + SW)
  (function createManifest(){
    const manifest = { name:'CareMarket â€“ Quick Reply & Calculator', short_name:'CareMarket', start_url:'./', display:'standalone', background_color:'#0b1220', theme_color:'#0ea5e9', icons:[{src:'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><rect width="100" height="100" rx="20" fill="%230ea5e9"/><path d="M50 10l12 24 26 4-19 18 4 26-23-12-23 12 4-26L12 38l26-4 12-24z" fill="%230b1220"/></svg>', sizes:'100x100', type:'image/svg+xml'}] };
    const blob = new Blob([JSON.stringify(manifest)],{type:'application/json'});
    const link = document.createElement('link'); link.rel='manifest'; link.href = URL.createObjectURL(blob); document.head.appendChild(link);
  })();

  (function registerSW(){
    if(!('serviceWorker' in navigator)) return;
    const swCode = `self.addEventListener('install',e=>{e.waitUntil(caches.open('cm-mvp-v1').then(c=>c.addAll(['./'])))});self.addEventListener('fetch',e=>{e.respondWith(caches.match(e.request).then(r=>r||fetch(e.request)))})`;
    const blob = new Blob([swCode], {type:'text/javascript'});
    const swUrl = URL.createObjectURL(blob);
    navigator.serviceWorker.register(swUrl).catch(()=>{});
  })();
  </script>
</body>
</html>